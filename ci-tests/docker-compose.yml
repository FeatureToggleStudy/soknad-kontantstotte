version: '3'

services:
  ci-test-server:
    image: navikt/node-express:1.0.0
    volumes:
      - ../dev-server:/var/server/
      - ../dist:/var/dist
    ports:
      - 8000:8000
    entrypoint:
      - node
      - /var/server/ci-server.js
  gemini:
    image: repo.adeo.no:5443/soknad/soknad-docker-gemini:1.0.0
    depends_on:
      - ci-test-server
      - chrome
      - selenium-hub
    volumes:
      - ./gemini:/var/gemini
      - ./reports/:/reports/
  pa11y:
    image: repo.adeo.no:5443/soknad/soknad-docker-pa11y:1.0.0
    depends_on:
      - ci-test-server
    volumes:
      - ./pa11y/:/var/pa11y/
      - ./reports/:/reports/
    cap_add:
      - SYS_ADMIN
  selenium-hub:
    image: selenium/hub:3.14.0
    container_name: selenium-hub
    ports:
      - 4444:4444
  chrome:
    image: selenium/node-chrome:3.14.0
    environment:
      - HUB_HOST=selenium-hub
      - HUB_PORT=4444
    depends_on:
      - selenium-hub
  testcafe:
    image: testcafe/testcafe
    command: 'firefox'
    depends_on:
      - ci-test-server
    volumes:
      - ./testcafe/:/tests